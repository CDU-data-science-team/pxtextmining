

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>pxtextmining.pipelines package &mdash; pxtextmining 0.2.7 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> pxtextmining
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">pxtextmining.pipelines package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-pxtextmining.pipelines.text_classification_pipeline">pxtextmining.pipelines.text_classification_pipeline module</a></li>
<li><a class="reference internal" href="#module-pxtextmining.pipelines">Module contents</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">pxtextmining</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>pxtextmining.pipelines package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/pxtextmining.pipelines.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pxtextmining-pipelines-package">
<h1>pxtextmining.pipelines package<a class="headerlink" href="#pxtextmining-pipelines-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-pxtextmining.pipelines.text_classification_pipeline">
<span id="pxtextmining-pipelines-text-classification-pipeline-module"></span><h2>pxtextmining.pipelines.text_classification_pipeline module<a class="headerlink" href="#module-pxtextmining.pipelines.text_classification_pipeline" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="pxtextmining.pipelines.text_classification_pipeline.text_classification_pipeline">
<span class="sig-prename descclassname"><span class="pre">pxtextmining.pipelines.text_classification_pipeline.</span></span><span class="sig-name descname"><span class="pre">text_classification_pipeline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">test_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.33</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ordinal</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tknz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'spacy'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metric</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'class_balance_accuracy_score'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cv</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learners</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['SGDClassifier']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">objects_to_save</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['pipeline',</span> <span class="pre">'tuning</span> <span class="pre">results',</span> <span class="pre">'predictions',</span> <span class="pre">'accuracy</span> <span class="pre">per</span> <span class="pre">class',</span> <span class="pre">'index</span> <span class="pre">-</span> <span class="pre">training</span> <span class="pre">data',</span> <span class="pre">'index</span> <span class="pre">-</span> <span class="pre">test</span> <span class="pre">data',</span> <span class="pre">'bar</span> <span class="pre">plot']</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_objects_to_server</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_objects_to_disk</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_pipeline_as</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">results_folder_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'results'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reduce_criticality</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theme</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#pxtextmining.pipelines.text_classification_pipeline.text_classification_pipeline" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit and evaluate the pipeline and write the results. Writes between 1 to 7 files, depending on the value of argument
<code class="docutils literal notranslate"><span class="pre">objects_to_save</span></code>:</p>
<ul class="simple">
<li><p>The fitted pipeline (SAV);</p></li>
<li><p>All (hyper)parameters tried during fitting and the associated pipeline performance metrics (CSV);</p></li>
<li><p>The predictions on the test set (CSV);</p></li>
<li><p>Accuracies per class (CSV);</p></li>
<li><p>The row indices of the training data (CSV);</p></li>
<li><p>The row indices of the test data (CSV);</p></li>
<li><p>A bar plot comparing the mean scores (of the user-supplied metric parameter) from the cross-validation on
the training set, for the best (hyper)parameter values for each learner (PNG);</p></li>
</ul>
<p><strong>NOTE:</strong> As described later, arguments <cite>reduce_criticality</cite> and <cite>theme</cite> are for internal use by Nottinghamshire
Healthcare NHS Foundation Trust or other trusts who use the theme (“Access”, “Environment/ facilities” etc.) and
criticality labels. They can otherwise be safely ignored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – Dataset name (CSV), including the data type suffix. If None, data is read from the database.</p></li>
<li><p><strong>target</strong> (<em>str</em>) – Name of the response variable.</p></li>
<li><p><strong>predictor</strong> (<em>str</em>) – Name of the predictor variable.</p></li>
<li><p><strong>test_size</strong> (<em>float</em>) – Proportion of data that will form the test dataset.</p></li>
<li><p><strong>ordinal</strong> (<em>bool</em>) – Whether to fit an ordinal classification model. The ordinal model is the implementation of
<a class="reference external" href="https://www.cs.waikato.ac.nz/~eibe/pubs/ordinal_tech_report.pdf">Frank and Hall (2001)</a> that can use any standard classification model.</p></li>
<li><p><strong>tknz</strong> (<em>str</em>) – Tokenizer to use (“spacy” or “wordnet”).</p></li>
<li><p><strong>metric</strong> (<em>str</em>) – Scorer to use during pipeline tuning (“accuracy_score”, “balanced_accuracy_score”,
“matthews_corrcoef”, “class_balance_accuracy_score”).</p></li>
<li><p><strong>cv</strong> (<em>int</em>) – Number of cross-validation folds.</p></li>
<li><p><strong>n_iter</strong> (<em>int</em>) – Number of parameter settings that are sampled
(see <a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html">sklearn.model_selection.RandomizedSearchCV</a>).</p></li>
<li><p><strong>n_jobs</strong> (<em>int</em>) – Number of jobs to run in parallel (see <code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.RandomizedSearchCV</span></code>).</p></li>
<li><p><strong>verbose</strong> (<em>int</em>) – Controls the verbosity (see <code class="docutils literal notranslate"><span class="pre">sklearn.model_selection.RandomizedSearchCV</span></code>).</p></li>
<li><p><strong>learners</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – A list of <code class="docutils literal notranslate"><span class="pre">Scikit-learn</span></code> names of the learners to tune. Must be one or more of
“SGDClassifier”, “RidgeClassifier”, “Perceptron”, “PassiveAggressiveClassifier”, “BernoulliNB”, “ComplementNB”,
“MultinomialNB”, “KNeighborsClassifier”, “NearestCentroid”, “RandomForestClassifier”.</p></li>
<li><p><strong>objects_to_save</strong> (<em>list</em><em>[</em><em>str</em><em>]</em>) – <p>Objects to save following pipeline fitting and assessment. These are:</p>
<ul>
<li><p>the pipeline (SAV file);</p></li>
<li><p>table with all (hyper)parameter values tried out and performance indicators on the cross-validation data;</p></li>
<li><p>table with predictions on the test set;</p></li>
<li><p>table with accuracy and counts per class;</p></li>
<li><p>row indices for the training set;</p></li>
<li><p>row indices for the test set;</p></li>
<li><p>bar plot with the best-performing models- plotted values are the mean scores from a k-fold CV on the training
set, for the best (hyper)parameter values for each learner;</p></li>
</ul>
</p></li>
<li><p><strong>save_objects_to_server</strong> (<em>bool</em>) – Whether to save the results to the server. <strong>NOTE:</strong> The feature that writes
results to the database is for internal use only. It will be removed when a proper API is developed for this
function.</p></li>
<li><p><strong>save_objects_to_disk</strong> (<em>bool</em>) – Whether to save the results to disk. See <code class="docutils literal notranslate"><span class="pre">results_folder_name</span></code>.</p></li>
<li><p><strong>save_pipeline_as</strong> (<em>str</em>) – Save the pipeline as <code class="docutils literal notranslate"><span class="pre">save_pipeline_as</span> <span class="pre">+</span> <span class="pre">'.sav'</span></code>.</p></li>
<li><p><strong>results_folder_name</strong> (<em>str</em>) – Name of folder in which to save the results. It will create a new folder or
overwrite an existing one that has the same name.</p></li>
<li><p><strong>reduce_criticality</strong> (<em>bool</em>) – For internal use by Nottinghamshire Healthcare NHS Foundation Trust or other trusts
that hold data on criticality. If <cite>True</cite>, then all records with a criticality of “-5” (respectively, “5”) are
assigned a criticality of “-4” (respectively, “4”). This is to avoid situations where the pipeline breaks due to
a lack of sufficient data for “-5” and/or “5”. Defaults to <cite>False</cite>.</p></li>
<li><p><strong>theme</strong> (<em>str</em>) – For internal use by Nottinghamshire Healthcare NHS Foundation Trust or other trusts
that use theme labels (“Access”, “Environment/ facilities” etc.). The column name of the theme variable.
Defaults to <cite>None</cite>. If supplied, the theme variable will be used as a predictor (along with the text predictor)
in the model that is fitted with criticality as the response variable. The rationale is two-fold. First, to
help the model improve predictions on criticality when the theme labels are readily available. Second, to force
the criticality for “Couldn’t be improved” to always be “3” in the training and test data, as well as in the
predictions. This is the only criticality value that “Couldn’t be improved” can take, so by forcing it to always
be “3”, we are improving model performance, but are also correcting possible erroneous assignments of values
other than “3” that are attributed to human error.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>A <code class="docutils literal notranslate"><span class="pre">tuple</span></code> of length 7:</p>
<ul class="simple">
<li><p>The fitted <code class="docutils literal notranslate"><span class="pre">Scikit-learn</span></code>/<code class="docutils literal notranslate"><span class="pre">imblearn</span></code> pipeline;</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with all (hyper)parameter values and models tried during fitting;</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with the predictions on the test set;</p></li>
<li><p>A <code class="docutils literal notranslate"><span class="pre">pandas.DataFrame</span></code> with accuracies per class;</p></li>
<li><p>A bar plot comparing the mean scores (of the user-supplied metric parameter) from the cross-validation on
the training set, for the best (hyper)parameter values for each learner.</p></li>
<li><p>The row indices of the training data;</p></li>
<li><p>The row indices of the test data;</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pxtextmining.pipelines">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pxtextmining.pipelines" title="Permalink to this headline">¶</a></h2>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NHS England.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>