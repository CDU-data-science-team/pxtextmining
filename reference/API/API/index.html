<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://cdu-data-science-team.github.io/pxtextmining/reference/API/API/" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>pxtextmining API - pxtextmining</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../../main.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "pxtextmining API";
        var mkdocs_page_input_path = "reference/API/API.md";
        var mkdocs_page_url = "/pxtextmining/reference/API/API/";
      </script>
    
    <script src="../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> pxtextmining
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../about/">Project background</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting%20started/install/">Install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting%20started/package/">Package structure</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting%20started/training_new_model/">Training a new model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../getting%20started/using_trained_model/">Using a trained model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">API</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">pxtextmining API</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#how-to-make-an-api-call">How to make an API call</a>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Pxtextmining</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Factories</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/factories/factory_data_load_and_split/">Factory data load and split</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/factories/factory_model_performance/">Factory model performance</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/factories/factory_pipeline/">Factory pipeline</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/factories/factory_predict_unlabelled_text/">Factory predict unlabelled text</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/factories/factory_write_results/">Factory write results</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Helpers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/helpers/text_preprocessor/">Text preprocessor</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/helpers/tokenization/">Tokenization</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Pipelines</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../pxtextmining/pipelines/multilabel_pipeline/">Multilabel pipeline</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">pxtextmining</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Reference &raquo;</li>
          <li>API &raquo;</li>
      <li>pxtextmining API</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="pxtextmining-api">pxtextmining API</h1>
<p>To facilitate the use of the models trained in this project, an API has been created using the FastAPI library. Users will be able to send their patient experience feedback comments to the model via the API, and will receive the predicted labels for those comments.</p>
<p>The API has been created using FastAPI and will be deployed on RStudio Connect. The URL is not publicly available at this stage in the project. Full documentation for the API, automatically generated by FastAPI, is available at [API URL]/docs</p>
<h2 id="how-to-make-an-api-call">How to make an API call</h2>
<p>1. Prepare the data in JSON format. In Python, this is a <code>list</code> containing as many <code>dict</code>s as there are comments to be predicted. Each <code>dict</code> has three compulsory keys:</p>
<ul>
<li><code>comment_id</code>: Unique ID associated with the comment, in <code>str</code> format. Each Comment ID per API call must be unique.</li>
<li><code>comment_text</code>: Text to be classified, in <code>str</code> format.</li>
<li><code>question_type</code>: The type of question asked to elicit the comment text. Questions are different from trust to trust, but they all fall into one of three categories:<ul>
<li><code>what_good</code>: Any variation on the question "What was good about the service?", or "What did we do well?"</li>
<li><code>could_improve</code>: Any variation on the question "Please tell us about anything that we could have done better", or "How could we improve?"</li>
<li><code>nonspecific</code>: Any other type of nonspecific question, e.g. "Please can you tell us why you gave your answer?", or "What were you satisfied and/or dissatisfied with?".</li>
</ul>
</li>
</ul>
<pre><code class="language-python"># In Python

text_data = [
              { 'comment_id': '1', # The comment_id values in each dict must be unique.
                'comment_text': 'This is the first comment. Nurse was great.',
                'question_type': 'what_good' },
              { 'comment_id': '2',
                'comment_text': 'This is the second comment. The ward was freezing.',
                'question_type': 'could_improve' },
              { 'comment_id': '3',
                'comment_text': '',  # This comment is an empty string.
                'question_type': 'nonspecific' }
            ]
</code></pre>
<pre><code class="language-R"># In R

library(jsonlite)

comment_id &lt;- c(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;)
comment_text &lt;- c(
  &quot;This is the first comment. Nurse was great.&quot;,
  &quot;This is the second comment. The ward was freezing.&quot;,
  &quot;&quot;
)
question_type &lt;- c(&quot;what_good&quot;, &quot;could_improve&quot;, &quot;nonspecific&quot;)
df &lt;- data.frame(comment_id, comment_text, question_type)
text_data &lt;- toJSON(df)
</code></pre>
<p>2. Send the JSON containing the text data to the <code>predict_multilabel</code> endpoint. In python, this can be done using the <code>requests</code> library.</p>
<pre><code class="language-python"># In Python

import requests

url = &quot;API_URL_GOES_HERE&quot;
headers = {'User-Agent': 'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36'}

response = requests.post(f&quot;{url}/predict_multilabel&quot;,
                          json = text_data, headers = headers)
</code></pre>
<pre><code class="language-R"># In R

library(httr)

r &lt;- POST(
  url = &quot;API_URL_GOES_HERE&quot;,
  body = text_data,
  encode = &quot;json&quot;,
  add_headers(
    &quot;User-Agent&quot; = &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.76 Safari/537.36&quot;,
    &quot;Content-Type&quot; = &quot;application/json&quot;
  )
)
</code></pre>
<p>3. After waiting for the data to be processed and passed through the machine learning model, receive predicted labels at the same endpoint, in the example format below. Note that the comment with blank text, with comment_id 3, was assigned the label 'Labelling not possible' as it would have been stripped out during preprocessing.</p>
<pre><code class="language-python"># In Python

print(response.json())
# Output below
[
  { 'comment_id': '1',
    'comment_text': 'This is the first comment. Nurse was great.',
    'labels': ['Non-specific praise for staff']} ,
  { 'comment_id': '2',
    'comment_text': 'This is the second comment. The ward was freezing.',
    'labels': ['Sensory experience']} ,
  { 'comment_id': '3',
    'comment_text': '',
    'labels': ['Labelling not possible'] }
]
</code></pre>
<pre><code class="language-R"># In R

r_parsed = fromJSON(content(r, &quot;text&quot;))
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../../getting%20started/using_trained_model/" class="btn btn-neutral float-left" title="Using a trained model"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../pxtextmining/factories/factory_data_load_and_split/" class="btn btn-neutral float-right" title="Factory data load and split">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../../getting%20started/using_trained_model/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../pxtextmining/factories/factory_data_load_and_split/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme_extra.js" defer></script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
