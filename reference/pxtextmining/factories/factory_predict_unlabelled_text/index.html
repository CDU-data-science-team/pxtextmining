<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://the-strategy-unit.github.io/pxtextmining/reference/pxtextmining/factories/factory_predict_unlabelled_text/" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>Factory predict unlabelled text - pxtextmining</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../../assets/_mkdocstrings.css" rel="stylesheet" />
        <link href="../../../../main.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Factory predict unlabelled text";
        var mkdocs_page_input_path = "reference\\pxtextmining\\factories\\factory_predict_unlabelled_text.md";
        var mkdocs_page_url = "/pxtextmining/reference/pxtextmining/factories/factory_predict_unlabelled_text/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> pxtextmining
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../../about/">Project background</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Getting started</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../getting%20started/install/">Install</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../getting%20started/package/">Package structure</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../getting%20started/training_new_model/">Training a new model</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../getting%20started/using_trained_model/">Using a trained model</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">API</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../API/API/">pxtextmining API overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../API/quick_API/">Quick API</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../API/slow_API/">Slow API</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Docker</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../Docker/docker_README/">Using our Docker container</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Pxtextmining</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">Factories</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" href="../factory_data_load_and_split/">Factory data load and split</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../factory_model_performance/">Factory model performance</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../factory_pipeline/">Factory pipeline</a>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Factory predict unlabelled text</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.process_text">process_text</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_multilabel_sklearn">predict_multilabel_sklearn</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_multilabel_bert">predict_multilabel_bert</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_sentiment_bert">predict_sentiment_bert</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_multiclass_bert">predict_multiclass_bert</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_with_probs">predict_with_probs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.get_probabilities">get_probabilities</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.get_labels">get_labels</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.predict_with_bert">predict_with_bert</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.fix_no_labels">fix_no_labels</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.turn_probs_into_binary">turn_probs_into_binary</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.rulebased_probs">rulebased_probs</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.get_thresholds">get_thresholds</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#pxtextmining.factories.factory_predict_unlabelled_text.combine_predictions">combine_predictions</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../factory_write_results/">Factory write results</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Helpers</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../helpers/text_preprocessor/">Text preprocessor</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">Pipelines</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../pipelines/multilabel_pipeline/">Multilabel pipeline</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../../pipelines/sentiment_pipeline/">Sentiment pipeline</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">pxtextmining</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Reference</li>
          <li class="breadcrumb-item">Pxtextmining</li>
          <li class="breadcrumb-item">Factories</li>
      <li class="breadcrumb-item active">Factory predict unlabelled text</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <div class="doc doc-object doc-module">



<h4 id="pxtextmining.factories.factory_predict_unlabelled_text" class="doc doc-heading">
          <code>factory_predict_unlabelled_text</code>


</h4>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.process_text" class="doc doc-heading">
          <code class="highlight language-python">process_text(text)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Enacts same text preprocessing as is found in factory_data_load_and_split when creating training data. Converts to string, removes trailing whitespaces, null values, punctuation and numbers. Converts to lowercase.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>text</code></b>
                  (<code><span title="pandas.Series">Series</span></code>)
              –
              <div class="doc-md-description">
                <p>Series containing data to be cleaned.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.Series">Series</span></code>
            –
            <div class="doc-md-description">
              <p>Processed text data</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_multilabel_sklearn" class="doc doc-heading">
          <code class="highlight language-python">predict_multilabel_sklearn(data, model, labels=minor_cats, additional_features=False, label_fix=True, rules_dict=None, custom_threshold_dict=None)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Conducts basic preprocessing to remove punctuation and numbers.
Utilises a pretrained sklearn machine learning model to make multilabel predictions on the cleaned text.
Also takes the class with the highest predicted probability as the predicted class in cases where no class has
been predicted, if fix_no_labels = True.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>pd.Series OR pd.DataFrame</code>)
              –
              <div class="doc-md-description">
                <p>DataFrame or Series containing data to be processed and utilised for predictions. Must be DataFrame with columns 'FFT answer' and 'FFT_q_standardised' if additional_features = True</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="sklearn.base">base</span></code>)
              –
              <div class="doc-md-description">
                <p>Trained sklearn estimator able to perform multilabel classification.</p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>, default:
                      <code><span title="pxtextmining.params.minor_cats">minor_cats</span></code>
)
              –
              <div class="doc-md-description">
                <p>List containing target labels. Defaults to major_cats.</p>
              </div>
            </li>
            <li>
              <b><code>additional_features</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not FFT_q_standardised is included in data. Defaults to False.</p>
              </div>
            </li>
            <li>
              <b><code>label_fix</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not the class with the highest probability is taken as the predicted class in cases where no classes are predicted. Defaults to True.</p>
              </div>
            </li>
            <li>
              <b><code>rules_dict</code></b>
                  (<code>dict</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If supplied, enhances predicted probabilities of specific classes with rules based on the text vocabulary.</p>
              </div>
            </li>
            <li>
              <b><code>custom_threshold_dict</code></b>
                  (<code>dict</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If supplied, binary predictions are based on custom thresholds for specific classes. If not specified, defaults to threshold of 0.5.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
            –
            <div class="doc-md-description">
              <p>DataFrame containing one hot encoded predictions, and a column with a list of the predicted labels.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_multilabel_bert" class="doc doc-heading">
          <code class="highlight language-python">predict_multilabel_bert(data, model, labels=minor_cats, additional_features=False, label_fix=True, custom_threshold_dict=None, rules_dict=None)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Conducts basic preprocessing to remove blank text.
Utilises a pretrained transformer-based machine learning model to make multilabel predictions on the cleaned text.
Also takes the class with the highest predicted probability as the predicted class in cases where no class has
been predicted, if fix_no_labels = True.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>pd.Series, pd.DataFrame, or tf.data.Dataset</code>)
              –
              <div class="doc-md-description">
                <p>DataFrame, Series, or Tensorflow Dataset containing data to be processed and utilised for predictions. Must be DataFrame with columns 'FFT answer' and 'FFT_q_standardised' if additional_features = True</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="tf.Model">Model</span></code>)
              –
              <div class="doc-md-description">
                <p>Trained tensorflow estimator able to perform multilabel classification.</p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>, default:
                      <code><span title="pxtextmining.params.minor_cats">minor_cats</span></code>
)
              –
              <div class="doc-md-description">
                <p>List containing target labels. Defaults to major_cats.</p>
              </div>
            </li>
            <li>
              <b><code>additional_features</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not FFT_q_standardised is included in data. Defaults to False.</p>
              </div>
            </li>
            <li>
              <b><code>label_fix</code></b>
                  (<code>bool</code>, default:
                      <code>True</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not the class with the highest probability is taken as the predicted class in cases where no classes are predicted. Defaults to True.</p>
              </div>
            </li>
            <li>
              <b><code>custom_threshold_dict</code></b>
                  (<code>dict</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If custom thresholds for each label probability should be used. If none provided, default of 0.5 is used where a label is given if the probability is &gt; 0.5. Keys of dict should correspond to labels.</p>
              </div>
            </li>
            <li>
              <b><code>rules_dict</code></b>
                  (<code>dict</code>, default:
                      <code>None</code>
)
              –
              <div class="doc-md-description">
                <p>If supplied, enhances predicted probabilities of specific classes with rules based on the text vocabulary.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
            –
            <div class="doc-md-description">
              <p>DataFrame containing one hot encoded predictions, and a column with a list of the predicted labels.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_sentiment_bert" class="doc doc-heading">
          <code class="highlight language-python">predict_sentiment_bert(data, model, additional_features=False, preprocess_text=False)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Conducts basic preprocessing to remove blank text.
Utilises a pretrained transformer-based machine learning model to make multilabel predictions on the cleaned text.
Also takes the class with the highest predicted probability as the predicted class in cases where no class has
been predicted, if fix_no_labels = True.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code>pd.Series OR pd.DataFrame</code>)
              –
              <div class="doc-md-description">
                <p>DataFrame or Series containing data to be processed and utilised for predictions. Must be DataFrame with columns 'FFT answer' and 'FFT_q_standardised' if additional_features = True</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="tf.Model">Model</span></code>)
              –
              <div class="doc-md-description">
                <p>Trained tensorflow estimator able to perform multilabel classification.</p>
              </div>
            </li>
            <li>
              <b><code>additional_features</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not FFT_q_standardised is included in data. Defaults to False.</p>
              </div>
            </li>
            <li>
              <b><code>preprocess_text</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not text is to be preprocessed (punctuation and numbers removed).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
            –
            <div class="doc-md-description">
              <p>DataFrame containing input data and predicted sentiment</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_multiclass_bert" class="doc doc-heading">
          <code class="highlight language-python">predict_multiclass_bert(x, model, additional_features)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Makes multiclass predictions using a transformer-based model. Can encode the data if not already encoded.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>DataFrame containing features to be passed through model.</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="tf.keras.models.Model">Model</span></code>)
              –
              <div class="doc-md-description">
                <p>Pretrained transformer based model in tensorflow keras.</p>
              </div>
            </li>
            <li>
              <b><code>additional_features</code></b>
                  (<code>bool</code>)
              –
              <div class="doc-md-description">
                <p>Whether or not additional features (e.g. question type) are included. Defaults to False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.array">array</span></code>
            –
            <div class="doc-md-description">
              <p>Predicted labels in one-hot encoded format.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_with_probs" class="doc doc-heading">
          <code class="highlight language-python">predict_with_probs(x, model, labels)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Given a trained model and some features, makes predictions based on the model's outputted probabilities using the model.predict_proba function.
Any label with a predicted probability over 0.5 is taken as the predicted label. If no labels are over 0.5 probability then the
label with the highest probability is taken.
Converts into one-hot encoded format (similar to what model.predict would output).
Currently only works with sklearn models.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>x</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Features to be used to make the prediction.</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="sklearn.base">base</span></code>)
              –
              <div class="doc-md-description">
                <p>Trained sklearn multilabel classifier.</p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of labels for the categories to be predicted.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.array">array</span></code>
            –
            <div class="doc-md-description">
              <p>Predicted labels in one hot encoded format based on model probability estimates.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.get_probabilities" class="doc doc-heading">
          <code class="highlight language-python">get_probabilities(label_series, labels, predicted_probabilities)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Given a pd.Series containing labels, the list of labels, and a model's outputted predicted_probabilities for each label,
create a dictionary containing the label and the predicted probability of that label.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>label_series</code></b>
                  (<code><span title="pandas.Series">Series</span></code>)
              –
              <div class="doc-md-description">
                <p>Series containing labels in the format <code>['label_one', 'label_two']</code></p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of the label names</p>
              </div>
            </li>
            <li>
              <b><code>predicted_probabilities</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Predicted probabilities for each label</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.Series">Series</span></code>
            –
            <div class="doc-md-description">
              <p>Series, each line containing a dict with the predicted probabilities for each label.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.get_labels" class="doc doc-heading">
          <code class="highlight language-python">get_labels(row, labels)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Given a one-hot encoded row of predictions from a dataframe,
returns a list containing the actual predicted labels as a <code>str</code>.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>row</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>Row in a DataFrame containing one-hot encoded predicted labels.</p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List containing all the target labels, which should also be columns in the dataframe.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code>list</code>
            –
            <div class="doc-md-description">
              <p>List of the labels that have been predicted for the given text.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.predict_with_bert" class="doc doc-heading">
          <code class="highlight language-python">predict_with_bert(data, model, max_length=150, additional_features=False)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Makes predictions using a transformer-based model. Can encode the data if not already encoded.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>data</code></b>
                  (<code><span title="pandas.DataFrame">DataFrame</span></code>)
              –
              <div class="doc-md-description">
                <p>DataFrame containing features to be passed through model.</p>
              </div>
            </li>
            <li>
              <b><code>model</code></b>
                  (<code><span title="tf.keras.models.Model">Model</span></code>)
              –
              <div class="doc-md-description">
                <p>Pretrained transformer based model in tensorflow keras.</p>
              </div>
            </li>
            <li>
              <b><code>max_length</code></b>
                  (<code>int</code>, default:
                      <code>150</code>
)
              –
              <div class="doc-md-description">
                <p>If encoding is required, maximum length of input text. Defaults to 150.</p>
              </div>
            </li>
            <li>
              <b><code>additional_features</code></b>
                  (<code>bool</code>, default:
                      <code>False</code>
)
              –
              <div class="doc-md-description">
                <p>Whether or not additional features (e.g. question type) are included. Defaults to False.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.array">array</span></code>
            –
            <div class="doc-md-description">
              <p>Predicted probabilities for each label.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.fix_no_labels" class="doc doc-heading">
          <code class="highlight language-python">fix_no_labels(binary_preds, predicted_probs)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Function that takes in the binary predicted labels for a particular input, and the predicted probabilities for
all the labels classes. Where no labels have been predicted for a particular input, takes the label with the highest predicted probability
as the predicted label.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>binary_preds</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Predicted labels, in a one-hot encoded binary format. Some rows may not have any predicted labels.</p>
              </div>
            </li>
            <li>
              <b><code>predicted_probs</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Predicted probability of each label.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.array">array</span></code>
            –
            <div class="doc-md-description">
              <p>Predicted labels in one-hot encoded format, with all rows containing at least one predicted label.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.turn_probs_into_binary" class="doc doc-heading">
          <code class="highlight language-python">turn_probs_into_binary(predicted_probs, custom_threshold_dict=None)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Takes predicted probabilities (floats between 0 and 1) and converts these to binary outcomes.
Scope to finetune this in later iterations of the project depending on the label and whether recall/precision
is prioritised for that label.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>predicted_probs</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Array containing the predicted probabilities for each class. Shape of array should be (num_samples, num_classes). Predicted probabilities should range from 0 to 1.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.array">array</span></code>
            –
            <div class="doc-md-description">
              <p>Array containing binary outcomes for each label. Shape should remain the same as input, but values will be either 0 or 1.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.rulebased_probs" class="doc doc-heading">
          <code class="highlight language-python">rulebased_probs(text, pred_probs, labels, rules_dict=rules_dict)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Uses the <code>rules_dict</code> in <code>pxtextmining.params</code> to boost the probabilities of specific classes, given the appearance of specific words.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>text</code></b>
                  (<code><span title="pandas.Series">Series</span></code>)
              –
              <div class="doc-md-description">
                <p>Series containing the text</p>
              </div>
            </li>
            <li>
              <b><code>pred_probs</code></b>
                  (<code><span title="numpy.ndarray">ndarray</span></code>)
              –
              <div class="doc-md-description">
                <p>Numpy array containing the outputted predicted probabilities for the text.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="numpy.ndarray">ndarray</span></code>
            –
            <div class="doc-md-description">
              <p>Numpy array with the modified predicted probabilities of the text.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.get_thresholds" class="doc doc-heading">
          <code class="highlight language-python">get_thresholds(y_true, y_probs, labels)</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Uses <code>sklearn.metrics.precision_recall_curve</code> to calculate the best threshold to use to maximise F1 score for each of the labels, on a binary one-vs-rest basis.
If zero division error occurs, the threshold is set to 0.5 automatically.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>y_true</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Array containing true one-hot encoded labels, of shape (num_samples, num_labels)</p>
              </div>
            </li>
            <li>
              <b><code>y_probs</code></b>
                  (<code><span title="numpy.array">array</span></code>)
              –
              <div class="doc-md-description">
                <p>Array containing predicted probabilities labels. Can be 2d or 3d depending on whether sklearn or tensorflow.keras output.</p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of labels in target class.</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code>dict</code>
            –
            <div class="doc-md-description">
              <p>Dict with key value pairs (label, recommended threshold) for maximising the F1 score.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>


<div class="doc doc-object doc-function">



<h5 id="pxtextmining.factories.factory_predict_unlabelled_text.combine_predictions" class="doc doc-heading">
          <code class="highlight language-python">combine_predictions(df_list, labels, method='probabilities')</code>

</h5>


  <div class="doc doc-contents ">
  
      <p>Combines outputted prediction dataframes from different models, using different methods.</p>



<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
      <th class="field-name">Parameters:</th>
      <td class="field-body">
        <ul class="first simple">
            <li>
              <b><code>df_list</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of predictions in pd.DataFrame format, produced with either <code>predict_multilabel_sklearn</code> or <code>predict_multilabel_bert</code></p>
              </div>
            </li>
            <li>
              <b><code>labels</code></b>
                  (<code>list</code>)
              –
              <div class="doc-md-description">
                <p>List of labels in the prediction dataframes.</p>
              </div>
            </li>
            <li>
              <b><code>method</code></b>
                  (<code>str</code>, default:
                      <code>&#39;probabilities&#39;</code>
)
              –
              <div class="doc-md-description">
                <p>Method to use for combining the predictions. Defaults to "probabilities", which uses the average of predicted probabilities from all models. This results in higher precision, lower recall, and the prediction threshold is lowered to 0.3. Otherwise, takes all predicted classes from all models (high recall, low precision).</p>
              </div>
            </li>
        </ul>
      </td>
    </tr>
  </tbody>
</table>


<table class="field-list">
  <colgroup>
    <col class="field-name" />
    <col class="field-body" />
  </colgroup>
  <tbody valign="top">
    <tr class="field">
    <th class="field-name">Returns:</th>
    <td class="field-body">
      <ul class="first simple">
          <li>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
            –
            <div class="doc-md-description">
              <p>New predictions.</p>
            </div>
          </li>
      </ul>
    </td>
    </tr>
  </tbody>
</table>
  </div>

</div>



  </div>

  </div>

</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../factory_pipeline/" class="btn btn-neutral float-left" title="Factory pipeline"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../factory_write_results/" class="btn btn-neutral float-right" title="Factory write results">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../factory_pipeline/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../factory_write_results/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../../..";</script>
    <script src="../../../../js/theme_extra.js"></script>
    <script src="../../../../js/theme.js"></script>
      <script src="../../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
